\section{两因素完全随机设计}

\subsection{基本特点}
我在考查两种不同的教学方法对学生的影响时，发现它对学生的影响不显著，可我对这种教学方法还挺有自信的，于是我去调查了其原因.结果发现，学生的智力有不同，对于那些智力不太高的学生，他们接受新事物的能力不太高，在我换用新的教学方法后，他们的成绩反而下降.于是下接下的实验我同时考查这两个因素，结果发现教学方法的主效应还是不显著，不过学生的智力主效应倒是显著了，并且交互作用显著.这说明不同的教学方法适合不同的学生.

多因素实验设计的好处在上例中可以充分体现，自变量对因变量的关系有时因为别的变量的影响而被掩盖了，所以想要揭示变量间的真实关系需要做同时纳入多个变量.

最简单的因素实验设计是完全随机因素设计.一个两因素完全随机实验设计适合用于这样的研究条件：

(1)研究中有两个自变量，每个自变量有两个或多水平
(2)如果一个自变量有$p$个水平，另一个自变量有$q$个水平，实验中含有$p \times q$个处理的结合，研究者感兴趣于所有处理水平的结合的效应.

这种实验设计的基本方法是，随机分配被试接受实验处理的结合，每个被试接受一个实验处理的结合.与单因素完全随机设计不同，在两因素完全随机设计中，每个被试接受的是一个处理的结合，而不是一个处理水平.

\begin{margintable}
    \centering
    \caption{两因素完全随机被试分配到处理}
    \labtab{two_random_sub_teat}
    \begin{tabular}{cccccc}
    \toprule
        $a_1$ & $a_1$ & $a_1$ & $a_2$ & $a_2$ & $a_2$ \\
    \midrule
        $b_1$ & $b_2$ & $b_3$ & $b_1$ & $b_2$ & $b_3$ \\
        $S_1$ & $S_2$ & $S_3$ & $S_4$ & $S_5$ & $S_6$ \\
        $S_7$ & $S_8$ & $S_9$ & $S_{10}$ & $S_{11}$ & $S_{12}$ \\
        $S_{13}$ & $S_{14}$ & $S_{15}$ & $S_{16}$ & $S_{17}$ & $S_{18}$ \\
        $S_{19}$ & $S_{20}$ & $S_{21}$ & $S_{22}$ & $S_{23}$ & $S_{24}$ \\
    \bottomrule    
    \end{tabular}
\end{margintable}

两因素完全随机设计被试分配到处理上的情况如\reftab{two_random_sub_treat}

\subsubsection{两因素完全随机实验设计模型}

\begin{definition}[两因素完全随机实验设计模型]
    \labdef{two_way_random_model}
    \begin{align*}
        Y_{ijk} & = \mu + \alpha _j + \beta _k  + \left( \alpha \beta \right) _{jk}  + \varepsilon _{i\left( jk \right)}\\
                  & \left( j=1,2,\cdots ,p;  k=1,2,\cdots ,q;  i=1,2,\cdots ,n \right)
    \end{align*}
    
    其中
    
    {
        \renewcommand\arraystretch{1.25}
        \begin{tabular}{ccl}
            $Y_{ijk}$            & - &    两个自变量在第$j，k$个水平上，被试$i$的分数\\ 
            $\mu$                & - &    总体平均值或真值\\
            $\alpha _j$          & - &    自变量$A$水平$j$的处理效应\\
            $\pi _i$             & - &    自变量$B$水平$k$的处理效应\\
            $\left( \alpha \beta \right)_{jk}$ &-& 水平$\alpha _j$和$\beta _k$的交互作用\\
            $\varepsilon _i{jk}$  & - &   被试的误差变异
        \end{tabular}
    }  

\end{definition}

\subsubsection{两因素完全随机实验设计检验的假说}
(1)$A$因素的处理效应为0，即
\[ \alpha _j =0 \]

或$A$因素各水平总体均数相等，即
\[ \mu _{.1.} = \mu _{.2.} = \cdots = \mu _{.p.} \]


(2)$B$因素的处理效应为0，即
\[ \beta _k = 0 \]

或$B$因素各水平总体平均数相等，即
\[ \mu _{..1} = \mu _{..2} = \cdots = \mu _{..1} \]

(3)$AB$的交互作用为0，即
\[ \left( \alpha \beta \right) _{jk} = 0 \]


\subsection{实验设计与计算举例}
\subsubsection{研究的问题}

\textbf{1.计算表}

\begin{margintable}
  \centering
  \caption{两因素完全随机设计$ABS$表}
  \label{two_random_ABS}
    \begin{tabular}{cccccc}
    \toprule
        $a_1$ & $a_1$ & $a_1$ & $a_2$ & $a_2$ & $a_2$ \\
        $b_1$ & $b_2$ & $b_3$ & $b_1$ & $b_2$ & $b_3$ \\
    \midrule
        \rowcolor[rgb]{ .867,  .922,  .969} 3     & 4     & 5     & 4     & 8     & 12 \\
        \rowcolor[rgb]{ .867,  .922,  .969} 6     & 6     & 7     & 5     & 9     & 13 \\
        \rowcolor[rgb]{ .867,  .922,  .969} 4     & 4     & 5     & 3     & 8     & 12 \\
        \rowcolor[rgb]{ .867,  .922,  .969} 3     & 2     & 2     & 3     & 7     & 11 \\
    \bottomrule
    \end{tabular}
\end{margintable}

\begin{margintable}
  \centering
  \caption{两因素完全随机设计$AB$表}
  \label{two_random_AB}
    \begin{tabular}{c|cc|c}
    \toprule
          & $a_1$ & $a_2$ & $\sum$ \\
    \midrule
          & $n=4$ &       &  \\
    $b_1$ & \cellcolor[rgb]{ 1,  .949,  .8}16 & \cellcolor[rgb]{ 1,  .949,  .8}15 & \cellcolor[rgb]{ .886,  .937,  .855}31 \\
    $b_2$ & \cellcolor[rgb]{ 1,  .949,  .8}16 & \cellcolor[rgb]{ 1,  .949,  .8}32 & \cellcolor[rgb]{ .886,  .937,  .855}48 \\
    $b_3$ & \cellcolor[rgb]{ 1,  .949,  .8}19 & \cellcolor[rgb]{ 1,  .949,  .8}48 & \cellcolor[rgb]{ .886,  .937,  .855}67 \\
    \midrule
    $\sum$ & \cellcolor[rgb]{ .929,  .929,  .929}51 & \cellcolor[rgb]{ .929,  .929,  .929}95 & \cellcolor[rgb]{ .851,  .882,  .949}146 \\
    \bottomrule
    \end{tabular}
\end{margintable}


\textbf{2.各种基本量的计算}
\begin{alignat*}{4}
    &\frac{\left( \sum_{k=1}^q{\sum_{j=1}^p{\sum_{i=1}^n{Y_{ijk}}}} \right) ^2}{npq}
    &&=\left[ Y \right] 
    &&=\frac{\left( 146 \right) ^2}{\left( 4 \right) \left( 2 \right) \left( 3 \right)}
    &&= 888.167\\
    %---------------------------------------------------------------------------------------------------
    &\sum_{k=1}^q{\sum_{j=1}^p{\sum_{i=1}^n{Y_{ijk}^{2}}}}
    &&=\left[ ABS \right] 
    &&=\left( 3 \right) ^2+\left( 6 \right) ^2+\cdots 
    &&=1140.000\\
    %---------------------------------------------------------------------------------------------------
    &\sum_{j=1}^p{\frac{\left( \sum_{k=1}^q{\sum_{i=1}^n{Y_{ijk}}} \right) ^2}{nq}}
    &&=\left[ A \right] 
    &&=\frac{\left( 51 \right) ^2}{\left( 4 \right) \left( 3 \right)}+\frac{\left( 95 \right) ^2}{\left( 4 \right) \left( 3 \right)}
    &&=968.833\\
     %---------------------------------------------------------------------------------------------------
    &\sum_{k=1}^q{\frac{\left( \sum_{j=1}^p{\sum_{i=1}^n{Y_{ijk}}} \right) ^2}{np}}
    &&=\left[ B \right] 
    &&=\frac{\left( 31 \right) ^2}{\left( 4 \right) \left( 2 \right)}+\frac{\left( 48 \right) ^2}{\left( 4 \right) \left( 2 \right)}+\frac{\left( 67 \right) ^2}{\left( 4 \right) \left( 2 \right)}
    &&=969.250\\
    %---------------------------------------------------------------------------------------------------
    &\sum_{k=1}^q{\sum_{j=1}^p{\frac{\left( \sum_{i=1}^n{Y_{ijk}} \right) ^2}{n}}}
    &&=\left[ AB \right] 
    &&=\frac{\left( 16 \right) ^2}{4}+\frac{\left( 15 \right) ^2}{4}+\cdots 
    &&=1106.500
\end{alignat*}


\textbf{3.平方和分解与计算}

\begin{definition}[两因素完全随机平方和分解]
\labdef{two_way_random_variance}
\begin{alignat*}{3}
    &    SS_{\text{总变异}}     &&=    SS_{\text{处理间}}    &&+    SS_{\text{处理内}}\\
    &                           &&=    \left( SSA + SSB + SSAB \right) &&+ SS_{\text{单元内}}
\end{alignat*}
\end{definition}

\begin{alignat*}{3}
    &    SS_{\text{总变异}}    &&=    [ABS] - [Y]                              &&=    251.833\\
    &    SSA                   &&=    [A]   - [Y]                              &&=    80.666\\
    &    SSB                   &&=    [B] - [Y]                                &&=     81.083\\
    &    SSAB                  &&=    [AB] - [Y] - SSA - SSB                   &&=    56.584\\
    &    SS_{\text{单元内}}    &&=     SS_{\text{总变异}} - SSA -SSB - SSAB     &&= 33.500
\end{alignat*}

\textbf{4.方差分析表及结果的解释}


\begin{table}[htbp]
	\centering
	\caption{两因素完全随机方差分析表}
	\labtab{two_way_random_ANOVA}
	{
		\begin{tabular}{lrrrrrr}
			\toprule
			\multicolumn{1}{c}{变异源} & \multicolumn{1}{c}{$SS$} & \multicolumn{1}{c}{$df$} & \multicolumn{1}{c}{$MS$} & \multicolumn{1}{c}{$F$} & \multicolumn{1}{c}{$p$} \\
			\midrule
			$A$(主题熟悉性) & 80.667 & 1.000 & 80.667 & 43.343 & $<$ .001  \\
			$B$(生字密度) & 81.083 & 2.000 & 40.542 & 21.784 & $<$ .001  \\
			$A \times B$ & 56.583 & 2.000 & 28.292 & 15.201 & $<$ .001  \\
			单元内误差 & 33.500 & 18.000 & 1.861 &  &    \\
			\bottomrule
		\end{tabular}
	}
\end{table}


\textbf{5.平方和与自由度分解图}

\subsection{一些解释}
\textbf{1.各种平方和的意义}

\textbf{2.同质性检查}
\begin{alignat*}{3}
    & SS_{\text{1组}} &&= \left( 3^2+6^2+\cdots \right) -\frac{\left( 16 \right) ^2}{4}    &&=    6\\
    & SS_{\text{2组}} &&= \left( 4^2+6^2+\cdots \right) -\frac{\left( 16 \right) ^2}{4}    &&=    8\\
    & SS_{\text{3组}} &&= \left( 5^2+7^2+\cdots \right) -\frac{\left( 19 \right) ^2}{4}    &&=    12.75\\
    & SS_{\text{4组}} &&= \left( 4^2+5^2+\cdots \right) -\frac{\left( 15 \right) ^2}{4}    &&=    2.75\\
    & SS_{\text{5组}} &&= \left( 8^2+9^2+\cdots \right) -\frac{\left( 32 \right) ^2}{4}    &&=    2\\
    & SS_{\text{6组}} &&= \left( 12^2+13^2+\cdots \right) -\frac{\left( 48 \right) ^2}{4}  &&=    2\\
    & F               &&=\frac{SS_{\text{最大}}}{SS_{\text{最小}}}=\frac{12.75}{2}         &&=6.375
\end{alignat*}

计算$F(3,3)=6,375$对应的概率，得到$p>.05$，表明6组被试是同质的.如果把上述6个组的平方和相加，可以得到直接计算单元内误差，这和前面用相减法得到的结果相同.
\[ SS_{\text{单元内}} = SS_{\text{1组}}+SS_{\text{2组}}+\cdots+SS_{\text{6组}}=33.500 \]